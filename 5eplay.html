<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5E全平台查询成分</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <link href="css/live2d.css" rel="stylesheet">
    <script src="stecit/5ePlayApi.js"></script>
    <script src="stecit/live2d.js"></script>
    <script src="stecit/perfectApi.js"></script>
    <script src="stecit/copy-toast.js"></script>
    <!-- 配置主题 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#FB7299',
                        secondary: '#3B82F6',
                        dark: {
                            bg: '#0F172A',
                            card: '#1E293B',
                            border: '#334155'
                        }
                    },
                    fontFamily: {
                        sans: ['Microsoft YaHei', 'Segoe UI', 'SimHei', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-down': 'slideDown 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-in-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow-lg {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .star-glow {
                text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
            }
        }
    </style>
</head>
<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js"></script>
<body class="bg-gray-50 text-gray-800 dark:bg-dark-bg dark:text-gray-100 transition-colors duration-300">
<!-- 顶部标题栏 -->

<header class="bg-gradient-to-r from-primary to-secondary text-white shadow-lg">
    <div class="container mx-auto px-4 py-6">
        <div class="flex justify-between items-center">
            <button id="search-mode" class="bg-white/20 hover:bg-white/30 transition-colors px-4 py-2 rounded-lg flex items-center gap-2">
                <img src="https://img1.baidu.com/it/u=1580765950,111642296&fm=253&fmt=auto&app=138&f=JPEG?w=190&h=190" id="5e-ico" width="40" height="40" class="rounded-full:hidden">
                <img src="https://img2.baidu.com/it/u=397258135,1119881798&fm=253&fmt=auto&app=138&f=PNG?w=243&h=243" id="perfect-ico" width="40" height="40" hidden class="rounded-full">
                <span class="5e-text:hidden">5E模式</span>
                <span class="hidden perfect-text">完美模式</span>
            </button>
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-shadow-lg">5E全平台查成分</h1>
            <button id="themeToggle" class="bg-white/20 hover:bg-white/30 transition-colors px-4 py-2 rounded-lg flex items-center gap-2">
                <i class="fa fa-moon-o dark:hidden"></i>
                <i class="fa fa-sun-o hidden dark:inline-block"></i>
                <span class="dark:hidden">暗色模式</span>
                <span class="hidden dark:inline-block">亮色模式</span>
            </button>
        </div>
        <p class="mt-2 opacity-90">快速查询对手的成分</p>
    </div>
</header>
<!-- 主内容区 -->
<main class="container mx-auto px-4 py-8">
    <!-- 搜索框区域 -->
    <div id="searchFrame" class="bg-white dark:bg-dark-card rounded-xl shadow-md p-6 mb-8 transition-all duration-300">
        <div class="flex flex-col md:flex-row gap-4">
            <input
                    type="text"
                    id="searchInput"
                    placeholder="输入玩家5E昵称"
                    class="flex-1 px-4 py-3 rounded-lg border border-gray-200 dark:border-dark-border bg-white dark:bg-dark-bg focus:outline-none focus:ring-2 focus:ring-primary transition-all"
            >
            <button
                    id="searchButton"
                    class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg font-medium transition-all transform hover:-translate-y-1 hover:shadow-lg flex items-center justify-center gap-2"
            >
                <i class="fa fa-search"></i>
                <span>搜索</span>
            </button>
        </div>

        <!-- 搜索进度条 -->
        <div id="searchProgressContainer" class="mt-4 hidden">
            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">搜索中...</div>
            <div class="w-full bg-gray-200 dark:bg-dark-border rounded-full h-2.5">
                <div id="searchProgressBar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <!-- 搜索结果状态 -->
        <div id="searchStatus" class="mt-4 text-center text-gray-500 dark:text-gray-400 hidden"></div>
    </div>

    <!-- 结果展示区域 -->
    <div id="resultsContainer" class="space-y-6"></div>

    <!-- 初始状态提示 -->
    <div id="initialState" class="text-center py-16 border border-dashed border-gray-200 dark:border-dark-border rounded-xl bg-white dark:bg-dark-card m-4">
        <i class="fa fa-search text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
        <p class="text-gray-500 dark:text-gray-400">输入玩家5E昵称 并点击搜索按钮开始查询</p>
    </div>
    <!-- 初始化看板娘 -->
    <div id="live2d-container">
        <div id="message-bubble"></div>
    </div>
</main>

<!-- 页脚 -->
<footer class="bg-white dark:bg-dark-card border-t border-gray-200 dark:border-dark-border py-4 mt-12">
    <div class="container mx-auto px-4 text-center text-gray-500 dark:text-gray-400 text-sm">
        <p>5E查成分 &copy; 2025 | 数据来源 完美平台 5E平台 Steam平台</p>
    </div>
</footer>

<!-- 用户卡片模板 (不显示，用于克隆) -->
<template id="userCardTemplate">
    <div class="user-card bg-white dark:bg-dark-card rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1">
        <div class="p-6">
            <div class="flex flex-col md:flex-row gap-6">
                <!-- 头像区域 -->
                <div class="flex-shrink-0">
                    <div class="w-24 h-24 rounded-lg border-2 border-gray-100 dark:border-dark-border overflow-hidden bg-gray-100 dark:bg-dark-border relative">
                        <img class="avatar w-full h-full object-cover" src="" alt="用户头像" onerror="this.src='https://picsum.photos/200/200?random=1'">
                        <div class="avatar-placeholder absolute inset-0 flex items-center justify-center text-gray-400">
                            <i class="fa fa-user-circle-o text-4xl"></i>
                        </div>
                    </div>
                </div>

                <!-- 基本信息区域 -->
                <div class="flex-1">
                    <div class="flex flex-wrap justify-between items-start gap-4 mb-4">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="score-badge bg-primary/10 text-primary"></span>
                                <span class="rank-badge"></span>
                            </div>
                            <div class="space-y-1 text-sm">
                                <p><span class="text-gray-500 dark:text-gray-400">5E昵称：</span><span class="pvp-nickname font-medium"></span></p>
                                <p><span class="text-gray-500 dark:text-gray-400">Steam昵称：</span><span class="app-nickname"></span></p>
                                <p><span class="text-gray-500 dark:text-gray-400">SteamID：</span><span class="steam-id font-mono text-sm"></span></p>
                                <!-- 隐藏状态显示 -->
                                <p class="hidden"><span class="text-gray-500 dark:text-gray-400">状态：</span><span class="online-status"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- 封禁状态 -->
                    <div class="mb-4">
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">账号状态</p>
                        <p class="forbid-info bg-gray-100 dark:bg-dark-card px-3 py-2 rounded text-sm"></p>
                    </div>

                    <!-- 按钮区域（新增复制按钮） -->
                    <div class="flex gap-3">
                        <button class="detail-btn bg-gray-100 hover:bg-gray-200 dark:bg-dark-border dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 w-full md:w-auto">
                            <i class="fa fa-info-circle"></i>
                            <span>查看详情</span>
                        </button>
                        <button class="copy-btn bg-gray-100 hover:bg-gray-200 dark:bg-dark-border dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 w-full md:w-auto">
                            <i class="fa fa-copy"></i>
                            <span>复制信息</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 详情区域 -->
            <div class="details-container mt-6 overflow-hidden max-h-0 transition-all duration-300">
                <div class="detail-progress-container hidden mb-4">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">加载详情中...</div>
                    <div class="w-full bg-gray-200 dark:bg-dark-border rounded-full h-2">
                        <div class="detail-progress-bar bg-primary h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <div class="details-placeholder text-center py-8 text-gray-500 dark:text-gray-400"></div>

                <!-- 账号信息容器 -->
                <div class="accounts-container hidden space-y-6">
                    <!-- 5E数据卡片 -->
                    <div class="account-card bg-gray-50 dark:bg-dark-bg rounded-lg p-4 border border-gray-100 dark:border-dark-border">
                    <div id="we-ban" class="absolute top-30 left-3 right-3 h-60 bg-contain bg-center bg-no-repeat" style="background-image: url('');"></div>
                        <h3 class="font-medium flex items-center gap-2 mb-4">
                            <span>5E数据</span>
                            <span class="text-xs bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400 px-2 py-0.5 rounded">5E账号</span>
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">5E昵称</p>
                                <p class="fivee-name bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">5E注册时间</p>
                                <p class="fivee-regdate bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">5E信誉分</p>
                                <p class="fivee-credit bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">5E违规记录</p>
                                <p class="fivee-report bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                        </div>

                        <div class="stats-container mb-4">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2 font-medium">5E统计数据</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center text-sm">
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">Rating</p>
                                    <p class="fivee-rating font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">游戏总时长</p>
                                    <p class="fivee-match_time_total font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">ELO</p>
                                    <p class="fivee-elo font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">ADR</p>
                                    <p class="fivee-adr font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">RWS</p>
                                    <p class="fivee-rws font-medium"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Steam数据卡片 -->
                    <div class="account-card bg-gray-50 dark:bg-dark-bg rounded-lg p-4 border border-gray-100 dark:border-dark-border">
                    <div id="steam-ban" class="absolute top-30 left-3 right-3 h-60 bg-contain bg-center bg-no-repeat" style="background-image: url('');"></div>
                        <h3 class="font-medium flex items-center gap-2 mb-4">
                            <span>Steam数据</span>
                            <span class="text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 px-2 py-0.5 rounded">Steam账号</span>
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Steam昵称</p>
                                <p class="steam-name bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">SteamID</p>
                                <p class="steam-id-detail font-mono text-sm bg-gray-100 dark:bg-dark-card px-2 py-1 rounded"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">注册时间</p>
                                <p class="steam-regtime bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">社区等级</p>
                                <p class="steam-level bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                        </div>

                        <div class="stats-container mb-4">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2 font-medium">Steam状态</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-center text-sm">
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">VAC状态</p>
                                    <p class="steam-vac font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">交易状态</p>
                                    <p class="steam-trade font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">游戏数量</p>
                                    <p class="steam-games font-medium"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 完美数据卡片 -->
                    <div class="account-card bg-gray-50 dark:bg-dark-bg rounded-lg p-4 border border-gray-100 dark:border-dark-border">
                    <div id="perfect-ban" class="absolute top-30 left-3 right-3 h-60 bg-contain bg-center bg-no-repeat" style="background-image: url('');"></div>
                        <h3 class="font-medium flex items-center gap-2 mb-4">
                            <span>完美数据</span>
                            <span class="text-xs bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 px-2 py-0.5 rounded">完美账号</span>
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">完美昵称</p>
                                <p class="perfect-name bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">完美APP昵称</p>
                                <p class="perfect-app-name bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                             <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">优先状态</p>
                                <p class="cs-info bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">完美排位分</p>
                                <p class="perfect-pvp-score bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                            <!-- 新增完美账号状态 -->
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">完美账号状态</p>
                                <p class="perfect-account-status bg-gray-100 dark:bg-dark-card px-2 py-1 rounded text-sm"></p>
                            </div>
                        </div>

                        <div class="stats-container mb-4">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2 font-medium">完美统计数据</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center text-sm">
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">场均击杀</p>
                                    <p class="pvp-kill font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">赛季场数</p>
                                    <p class="cnt-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">WE评分</p>
                                    <p class="avgWe-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">胜率</p>
                                    <p class="winRaing-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">爆头率</p>
                                    <p class="Ratio-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">Rating</p>
                                    <p class="Raing-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">ADR</p>
                                    <p class="ADR-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">Rws</p>
                                    <p class="Rws-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">K/D</p>
                                    <p class="kd-pvp font-medium">未提供</p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">最高评分</p>
                                    <p class="max-pvp font-medium"></p>
                                </div>
                            </div>
                        </div>

                        <!-- 国服数据 -->
                        <div class="official-stats-container mb-4">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2 font-medium">国服数据</p>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-center text-sm">
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">游戏时长</p>
                                    <p class="play-time font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">胜率</p>
                                    <p class="win-rate font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">爆头率</p>
                                    <p class="headShotRatio-off font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">存活率</p>
                                    <p class="kast-off font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">kd</p>
                                    <p class="kd-off font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">Rating</p>
                                    <p class="rating-off font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">ADR</p>
                                    <p class="ADR-off font-medium"></p>
                                </div>
                                <div class="bg-gray-100 dark:bg-dark-card p-2 rounded">
                                    <p class="text-gray-500 dark:text-gray-400">Rws</p>
                                    <p class="Rws-off font-medium"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    // 初始化 Live2D 看板娘
    L2Dwidget.init({
        model: {
            jsonPath: 'https://cdn.jsdelivr.net/npm/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json',
            scale: 1
        },
        display: {
            position: 'right',
            width: 150,
            height: 300,
            hOffset: 0,
            vOffset: -20,
        },
        mobile: {
            show: true,
            scale: 0.8
        },
        react: {
            opacityDefault: 0.7,
            opacityOnHover: 0.9
        },
        onload: function () {
            console.log('Live2D 模型加载完成！');
            setTimeout(() => {
                showMessage("你好呀～点击我试试！", 4000);
            }, 500);
        }
    });

    // 核心交互逻辑
    document.addEventListener('canvas_created', function() {
        console.log('canvas_created 事件触发');
        const canvas = document.querySelector('#live2d-container canvas');
        if (canvas) {
            canvas.addEventListener('click', function () {
                console.log('模型被点击了！');
                const replies = [
                    "你好呀！",
                    "有什么可以帮你吗？",
                    "今天天气真好～",
                    "不要戳我啦～",
                    "我是你的看板娘 Shizuku！",
                    "喜欢和你聊天～"
                ];
                const randomReply = replies[Math.floor(Math.random() * replies.length)];

                // 显示气泡
                showMessage(randomReply);

                // 播放点击动画
                l2dwidget.sendMessage('showAnimation', 'tap_body');
            });
        } else {
            console.warn('未找到 canvas 元素！');
        }
    });
    // 主搜索函数
    async function performSearch(keyword) {
        const resultsContainer = document.getElementById('resultsContainer');
        const searchProgressContainer = document.getElementById('searchProgressContainer');
        const searchProgressBar = document.getElementById('searchProgressBar');
        const searchStatus = document.getElementById('searchStatus');
        const initialState = document.getElementById('initialState');

        resultsContainer.innerHTML = '';
        searchProgressContainer.classList.remove('hidden');
        searchProgressBar.style.width = '10%';
        searchStatus.classList.add('hidden');
        initialState.classList.add('hidden');

        try {
            // 步骤 1: 只获取基础的用户列表
            const searchResult = await get_player(keyword);
            if (!searchResult || !searchResult.data?.user?.list || searchResult.data.user.list.length === 0) {
                searchStatus.textContent = '未找到匹配的用户';
                searchStatus.classList.remove('hidden');
                searchProgressBar.style.width = '100%';
                return;
            }

            const users = searchResult.data.user.list;
            const totalUsers = users.length;
            searchProgressBar.style.width = `${90}%`; // 快速完成进度条，因为后续数据懒加载

            for (let i = 0; i < totalUsers; i++) {
                const user = users[i];
                console.log(`正在为用户 "${user.username}" 创建基础卡片...`);

                // 步骤 2: 只为创建基础卡片获取必要的最小数据
                const uuid = await get_uuid(user.domain);
                const userData = await get_userData(uuid);

                // 步骤 3: 创建简化的用户对象，只包含基础信息
                const formattedUser = {
                    userId: uuid,
                    pvp_nickname: user.username,
                    app_nickname: '点击查看详情', // 占位
                    steam_id: '点击查看详情',     // 占位
                    steam_name: '',
                    pvp_score: 0, // 占位
                    avatar: user.avatar_url ? imgeshost + user.avatar_url : '',
                    // 存储原始数据供后续使用
                    _raw: {
                        user: user,
                        uuid: uuid,
                        userData: userData
                    }
                };

                // 步骤 4: 创建并添加用户卡片
                const userCard = createUserCard(formattedUser);
                resultsContainer.appendChild(userCard);
            }

            searchProgressBar.style.width = '100%';
        } catch (e) {
            console.error("搜索过程出错:", e);
            searchStatus.textContent = `搜索过程出错: ${e.message}`;
            searchStatus.classList.remove('hidden');
            searchProgressBar.style.width = '100%';
        }
    }

    // 创建用户卡片 5e
    function createUserCard(userData) {
        const template = document.getElementById('userCardTemplate');
        const card = document.importNode(template.content, true).querySelector('.user-card');

        // 设置基础信息
        const rawUser = userData._raw.user;
        const rawUserData = userData._raw.userData;

        card.querySelector('.pvp-nickname').textContent = rawUser.username;
        card.querySelector('.app-nickname').textContent = userData.app_nickname;
        card.querySelector('.steam-id').textContent = userData.steam_id;

        // 账号状态
        const accountStatusText = rawUserData ? (WE_account_status[rawUserData.account_status] || '未知状态') : '未知状态';
        card.querySelector('.forbid-info').textContent = accountStatusText;

        // 设置5E分数和段位 (占位)
        const scoreBadge = card.querySelector('.score-badge');
        const rankBadge = card.querySelector('.rank-badge');
        const pvpScore = userData.pvp_score;
        scoreBadge.textContent = `5E排位分: ${pvpScore === 0 ? '点击查看' : pvpScore}`;
        const rankText = getRankText(pvpScore);
        const rankColor = getRankColor(pvpScore);
        rankBadge.innerHTML = rankText;
        rankBadge.style.backgroundColor = rankColor;
        rankBadge.style.color = "#fff";
        rankBadge.style.padding = "0 6px";
        rankBadge.style.borderRadius = "4px";
        rankBadge.style.fontWeight = "bold";
        if (rankText.includes('S ')) {
            rankBadge.classList.add('star-glow');
        }

        // 设置头像
        const avatarImg = card.querySelector('.avatar');
        const avatarPlaceholder = card.querySelector('.avatar-placeholder');
        if (userData.avatar && userData.avatar.trim() !== '') {
            avatarImg.src = userData.avatar;
            avatarImg.onload = () => { avatarPlaceholder.style.display = 'none'; };
        } else {
            avatarPlaceholder.style.display = 'flex';
        }

        // 绑定详情按钮事件 - 核心修改点
        const detailBtn = card.querySelector('.detail-btn');
        const detailsContainer = card.querySelector('.details-container');
        const detailsPlaceholder = card.querySelector('.details-placeholder');
        const accountsContainer = card.querySelector('.accounts-container');
        const progressContainer = card.querySelector('.detail-progress-container');
        const progressBar = card.querySelector('.detail-progress-bar');

        let detailsLoaded = false;
        let detailsVisible = false;

        // 填充详情数据的函数
        const fillCardDetails = async () => {
            const uuid = userData._raw.uuid;
            const rawUser = userData._raw.user;
            const rawUserData = userData._raw.userData;

            // 并行获取所有详细数据
            const [matchId, homeData] = await Promise.all([
                get_macthlist(uuid),
                get_home(uuid)
            ]);

            const steamId = await get_steamID(matchId, uuid);
            const steamData = await get_steamData(steamId);

            // 获取完美平台信息
            const perfectUserInfo = await searchUsers(steamId)[0];
            const PVPIfon = await getAccountMatches(steamId)
            const [csInfo, officialInfo,PvPStats, perfectAccountStatus] = steamId ? await Promise.all([
                getCsInfo(steamId),
                getOfficialStats(steamId),
                getPvPStats(steamId),
                getAccountForbidInfo(steamId)
            ]) : ["无法获取优先状态", null, "未知"];

            // 格式化完整的用户数据
            const maxPvpScore = getUserMaxScore(PVPIfon);//完美最高分数
            const fullUserData = {
                userId: uuid,
                pvp_nickname: rawUser.username,
                app_nickname: steamData?.SteamName || '未知',
                steam_id: steamId || '未知',
                pvp_score: homeData?.elo || 0,
                avatar: rawUser.avatar_url ? imgeshost + rawUser.avatar_url : '',
                // 5E数据
                fiveeData: {
                    regDate: rawUserData ? convertTimestamp(rawUserData.reg_date) : '未知',
                    creditScore: rawUserData?.credit_score || '未知',
                    reportCount: rawUserData?.report_count || 0,
                    rating: homeData?.rating || '0',
                    elo: homeData?.elo || '0',
                    adr: homeData?.adr || '0',
                    rws: homeData?.rws || '0'
                },
                // Steam数据
                steamData: {
                    name: steamData?.SteamName || '未知',
                    regTime: steamData?.['Steam 注册时间'] || '未知',
                    level: steamData?.['Steam 社区等级'] || '未知',
                    vac: steamData?.['VAC 作弊系统检测'] || '未知',
                    trade: steamData?.['Steam 交易状态'] || '未知',
                    games: steamData?.['Steam 游戏数'] || '未知'
                },
                // 完美数据
                perfectData: {
                    pvpNickName: perfectUserInfo?.pvpNickName || '未知',
                    appNickName: perfectUserInfo?.appNickName || '未知',
                    pvpScore: perfectUserInfo?.pvpScore || '0',
                    csInfo: csInfo,
                    PvPStats:PvPStats || {},
                    maxPvpScore: maxPvpScore,
                    officialStats: officialInfo || {},
                    accountStatus: perfectAccountStatus || '未知'
                },
                // 账号状态
                accountStatus: rawUserData ? (WE_account_status[rawUserData.account_status] || '未知状态') : '未知状态',
                accountStatus_: rawUserData?.account_status
            };

            // 更新卡片的基础信息
            card.querySelector('.app-nickname').textContent = fullUserData.app_nickname;
            card.querySelector('.steam-id').textContent = fullUserData.steam_id;

            // 更新5E分数和段位
            const newPvpScore = fullUserData.pvp_score;
            scoreBadge.textContent = `5E排位分: ${newPvpScore === 0 ? '未定级' : newPvpScore}`;
            const newRankText = getRankText(newPvpScore);
            const newRankColor = getRankColor(newPvpScore);
            rankBadge.innerHTML = newRankText;
            rankBadge.style.backgroundColor = newRankColor;
            if (newRankText.includes('S ')) {
                rankBadge.classList.add('star-glow');
            } else {
                rankBadge.classList.remove('star-glow');
            }

            // 填充5E数据
            const fiveeCard = card.querySelector('.accounts-container .account-card:nth-child(1)');
            const we_absolute = card.querySelector('#we-ban');
            if (fullUserData.accountStatus_ === '0' || !fullUserData.accountStatus_) {
                we_absolute.classList.add('hidden');
            } else {
                we_absolute.style.backgroundImage = `url(${statusToImageUrl[fullUserData.accountStatus_] || ''})`;
                we_absolute.classList.remove('hidden');
            }

            fiveeCard.querySelector('.fivee-name').textContent = fullUserData.pvp_nickname;
            fiveeCard.querySelector('.fivee-regdate').textContent = fullUserData.fiveeData.regDate;
            fiveeCard.querySelector('.fivee-credit').textContent = fullUserData.fiveeData.creditScore;
            fiveeCard.querySelector('.fivee-report').textContent = fullUserData.fiveeData.reportCount;
            fiveeCard.querySelector('.fivee-rating').textContent = fullUserData.fiveeData.rating;
            fiveeCard.querySelector('.fivee-elo').textContent = fullUserData.fiveeData.elo;
            fiveeCard.querySelector('.fivee-match_time_total').textContent = rawUserData.match_time_total / 60 || -2233;
            fiveeCard.querySelector('.fivee-adr').textContent = fullUserData.fiveeData.adr;
            fiveeCard.querySelector('.fivee-rws').textContent = fullUserData.fiveeData.rws;

            // 填充Steam数据
            const steamCard = card.querySelector('.accounts-container .account-card:nth-child(2)');
            const steam_absolute = card.querySelector('#steam-ban');
            if (fullUserData.steamData.vac === '正常' || fullUserData.steamData.vac === '未知') {
                steam_absolute.classList.add('hidden');
            } else {
                steam_absolute.style.backgroundImage = `url('ban-imges/vac-ban.png')`;
                steam_absolute.classList.remove('hidden');
            }
            steamCard.querySelector('.steam-name').textContent = fullUserData.steamData.name;
            steamCard.querySelector('.steam-id-detail').textContent = fullUserData.steam_id;
            steamCard.querySelector('.steam-regtime').textContent = fullUserData.steamData.regTime;
            steamCard.querySelector('.steam-level').textContent = fullUserData.steamData.level;
            steamCard.querySelector('.steam-vac').textContent = fullUserData.steamData.vac;
            steamCard.querySelector('.steam-trade').textContent = fullUserData.steamData.trade;
            steamCard.querySelector('.steam-games').textContent = fullUserData.steamData.games;

            // 填充完美数据
            const perfectCard = card.querySelector('.accounts-container .account-card:nth-child(3)');
            const perfectCard_absolute = card.querySelector('#perfect-ban');
            if (fullUserData.perfectData.accountStatus === '状态正常' || fullUserData.perfectData.accountStatus === '未知') {
                perfectCard_absolute.classList.add('hidden');
            } else {
                perfectCard_absolute.style.backgroundImage = `url('ban-imges/pac-ban.png')`;
                perfectCard_absolute.classList.remove('hidden');
            }
            perfectCard.querySelector('.perfect-name').textContent = fullUserData.perfectData.pvpNickName;//完美昵称
            perfectCard.querySelector('.perfect-app-name').textContent = fullUserData.perfectData.appNickName;//完美APP昵称
            perfectCard.querySelector('.cs-info').textContent = fullUserData.perfectData.csInfo;//优先状态
            perfectCard.querySelector('.perfect-pvp-score').textContent = fullUserData.perfectData.pvpScore === '0' ? '未定级' : fullUserData.perfectData.pvpScore;//完美排位分
            perfectCard.querySelector('.max-pvp').textContent = fullUserData.perfectData.maxPvpScore || 'D-';//完美历史最高分数
            perfectCard.querySelector('.kd-pvp').textContent = fullUserData.perfectData.PvPStats.kd || -2233;//完美KD
            perfectCard.querySelector('.ADR-pvp').textContent = fullUserData.perfectData.PvPStats.adr || -2233;//完美ADR
            perfectCard.querySelector('.Raing-pvp').textContent = fullUserData.perfectData.PvPStats.rating || -2233;//完美Rating
            perfectCard.querySelector('.Ratio-pvp').textContent = fullUserData.perfectData.PvPStats.headShotRatio * 100 || -2233;//完美爆头率
            perfectCard.querySelector('.winRaing-pvp').textContent = `${parseInt(fullUserData.perfectData.PvPStats.winRate * 100)}%` || -2233;//完美胜率
            perfectCard.querySelector('.avgWe-pvp').textContent = fullUserData.perfectData.PvPStats.avgWe || -2233;//完美WE评分
            perfectCard.querySelector('.cnt-pvp').textContent = fullUserData.perfectData.PvPStats.cnt || -2233;//完美赛季场数
            perfectCard.querySelector('.Rws-pvp').textContent = fullUserData.perfectData.PvPStats.rws || -2233;//完美赛季场数
            perfectCard.querySelector('.pvp-kill').textContent = parseInt(fullUserData.perfectData.PvPStats.kills / fullUserData.perfectData.PvPStats.cnt) || -2233;//完美场均击杀
            perfectCard.querySelector('.perfect-account-status').textContent = fullUserData.perfectData.accountStatus;

            // 填充国服数据
            if (Object.keys(fullUserData.perfectData.officialStats).length > 0) {
                perfectCard.querySelector('.play-time').textContent =
                    fullUserData.perfectData.officialStats.hours
                        ? `${fullUserData.perfectData.officialStats.hours}小时`
                        : '未知';
                perfectCard.querySelector('.win-rate').textContent =
                    fullUserData.perfectData.officialStats.winRate
                        ? `${(fullUserData.perfectData.officialStats.winRate * 100).toFixed(1)}%`
                        : '未知';
                perfectCard.querySelector('.kd-off').textContent = fullUserData.perfectData.officialStats.kd || '[N/A]';
                perfectCard.querySelector('.rating-off').textContent = fullUserData.perfectData.officialStats.rating || '[N/A]';
                perfectCard.querySelector('.headShotRatio-off').textContent = fullUserData.perfectData.officialStats.headShotRatio || '[N/A]';
                perfectCard.querySelector('.ADR-off').textContent = fullUserData.perfectData.officialStats.adr || '[N/A]';
                perfectCard.querySelector('.kast-off').textContent = fullUserData.perfectData.officialStats.kast ? `${fullUserData.perfectData.officialStats.kast}%` : '[N/A]';
                perfectCard.querySelector('.Rws-off').textContent = fullUserData.perfectData.officialStats.rws || '[N/A]';
            } else {
                perfectCard.querySelector('.play-time').textContent = '[N/A]';
                perfectCard.querySelector('.win-rate').textContent = '[N/A]';
                perfectCard.querySelector('.kd-off').textContent = '[N/A]';
                perfectCard.querySelector('.rating-off').textContent = '[N/A]';
                perfectCard.querySelector('.headShotRatio-off').textContent = '[N/A]';
                perfectCard.querySelector('.ADR-off').textContent = '[N/A]';
                perfectCard.querySelector('.kast-off').textContent = '[N/A]';
                perfectCard.querySelector('.Rws-off').textContent = '[N/A]';
            }

            return fullUserData;
        };

        // 详情按钮点击事件
        detailBtn.addEventListener('click', async () => {
            if (detailsLoaded) {
                // 切换详情显示/隐藏
                detailsVisible = !detailsVisible;
                if (detailsVisible) {
                    detailsContainer.style.maxHeight = '2000px';
                    detailBtn.innerHTML = '<i class="fa fa-chevron-up"></i><span>隐藏详情</span>';
                } else {
                    detailsContainer.style.maxHeight = '0';
                    detailBtn.innerHTML = '<i class="fa fa-info-circle"></i><span>查看详情</span>';
                }
                return;
            }

            // 首次点击，加载详情数据
            detailBtn.disabled = true;
            detailBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i><span>加载中...</span>';
            detailsPlaceholder.textContent = '正在整理数据，请稍候...';
            progressContainer.classList.remove('hidden');
            progressBar.style.width = '0%';

            try {
                // 模拟进度（可选，提升用户体验）
                const progressInterval = setInterval(() => {
                    if (progressBar.style.width === '100%') {
                        clearInterval(progressInterval);
                    } else {
                        progressBar.style.width = `${parseInt(progressBar.style.width) + 10}%`;
                    }
                }, 100);

                // 加载并填充详情数据
                await fillCardDetails();

                // 完成加载
                clearInterval(progressInterval);
                detailsPlaceholder.classList.add('hidden');
                accountsContainer.classList.remove('hidden');
                progressBar.style.width = '100%';

                // 更新UI状态
                detailsContainer.style.maxHeight = '2000px';
                detailBtn.innerHTML = '<i class="fa fa-chevron-up"></i><span>隐藏详情</span>';
                detailsVisible = true;
                detailsLoaded = true;
            } catch (e) {
                console.error("加载详情错误:", e);
                detailsPlaceholder.textContent = `加载详情失败: ${e.message}`;
                detailsPlaceholder.classList.remove('hidden');
                accountsContainer.classList.add('hidden');
            } finally {
                detailBtn.disabled = false;
                progressContainer.classList.add('hidden');
            }
        });

        return card;
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
        var currentSearchMode = '5e';//初始搜索模式为5E接口
        // 搜索按钮点击事件
        const searchButton = document.getElementById('searchButton');
        const searchInput = document.getElementById('searchInput');

        searchButton.addEventListener('click', () => {
            const keyword = searchInput.value.trim();
            if (keyword) {
                if (currentSearchMode === '5e') {
                    performSearch(keyword);
                }if(currentSearchMode === 'perfect') {
                    //PerfectSearch(keyword);
                    showMessage('接口暂时停用Q^Q,正在修复此问题');
                    //showCopyToast('接口暂时停用Q^Q','error','color: #9E9E9E;');//预留为完美搜索接口做保留
                }
            }
        });

        // 回车键触发搜索
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const keyword = searchInput.value.trim();
                if (keyword) {
                    if (currentSearchMode === '5e') {
                        performSearch(keyword);
                    }if(currentSearchMode === 'perfect') {
                        //PerfectSearch(keyword);
                        showCopyToast('接口暂时停用Q^Q','error','color: #9E9E9E;');//预留为完美搜索接口做保留
                    }
                }
            }
        });
        // 搜索模式切换
        const fiveeIco = document.getElementById('5e-ico');
        const perfectIco = document.getElementById('perfect-ico');
        const search_mode = document.querySelector('#search-mode');
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        search_mode.addEventListener('click', () => { //更换接口搜索事件
            if (search_mode.querySelector('span').innerText === '5E模式') {
                search_mode.querySelector('span').innerText = '完美模式';
                currentSearchMode = 'perfect';
                console.log(currentSearchMode);
                perfectIco.hidden = false;
                fiveeIco.hidden = true;
            }else{
                search_mode.querySelector('span').innerText = '5E模式';
                currentSearchMode = '5e';
                console.log(currentSearchMode);
                perfectIco.hidden = true;
                fiveeIco.hidden = false;

            }
        });

        // 主题切换
        const themeToggle = document.getElementById('themeToggle');
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        themeToggle.addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        });


        // 复制用户信息功能
        document.addEventListener('click', function(e) {
            if (e.target.closest('.copy-btn')) {
                const card = e.target.closest('.user-card');
                if (!card) return;

                // 获取需要复制的信息
                const fiveeName = card.querySelector('.fivee-name')?.textContent || '未提供';
                const perfectName = card.querySelector('.perfect-name')?.textContent || '未提供';
                const steamName = card.querySelector('.steam-name')?.textContent || '未提供';
                const perfectAppName = card.querySelector('.perfect-app-name')?.textContent || '未提供';

                // 格式化复制内容
                const copyText = `5E昵称: ${fiveeName}  完美昵称: ${perfectName} Steam昵称: ${steamName} 完美APP昵称: ${perfectAppName}`;

                // 执行复制
                navigator.clipboard.writeText(copyText).then(() => {
                    // 显示复制成功提示
                    const copyBtn = e.target.closest('.copy-btn');
                    const originalHtml = copyBtn.innerHTML;
                    showCopyToast('复制成功(#^.^#)','success','color: #9E9E9E;');
                    copyBtn.innerHTML = '<i class="fa fa-check"></i><span>复制成功!</span>';

                    // 2秒后恢复原文本
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHtml;
                    }, 2000);
                }).catch(err => {
                    console.error('复制失败:', err);
                    alert('复制失败，请手动复制');
                });
            }
        });
    });
</script>
</body>
</html>